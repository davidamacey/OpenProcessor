# =============================================================================
# docker-compose.override.yml
# Generated by setup.sh - Profile: full
# =============================================================================
# This file overrides settings in docker-compose.yml based on your GPU profile.
# Regenerate with: ./scripts/openprocessor.sh profile full
# =============================================================================

services:
  triton-server:
    shm_size: 8g
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ['0']
              capabilities:
                - gpu

  yolo-api:
    shm_size: 8g
    command:
      - uvicorn
      - src.main:app
      - --host=0.0.0.0
      - --port=8000
      - --workers=32
      - --limit-max-requests=10000
      - --loop=uvloop
      - --http=httptools
      - --backlog=4096
      - --limit-concurrency=512
      - --timeout-keep-alive=75
      - --timeout-graceful-shutdown=30
      - --access-log
      - --log-level=info
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ['0']
              capabilities:
                - gpu

  opensearch:
    environment:
      - discovery.type=single-node
      - bootstrap.memory_lock=true
      - "OPENSEARCH_JAVA_OPTS=-Xms4g -Xmx4g"
      - DISABLE_SECURITY_PLUGIN=true
